
local gui = Instance.new("ScreenGui")
gui.Parent = game.CoreGui

-- Kiểm tra file keynigga.txt
local keyVerified = false
local snowGui = nil
local correctKey = "MatchaTeaOnTop"
local keyFile = "keymatcha.txt"

if isfile(keyFile) then
    local savedKey = readfile(keyFile)
    if savedKey == correctKey then
        keyVerified = true
        print("Valid saved key! Skipping GUI...")
    end
end

-- Nếu key chưa verified, tạo GUI
if not keyVerified then
    -- Frame chủ đề tuyết lạnh
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 220, 0, 160)
    frame.Position = UDim2.new(0.5, -110, 0.5, -80)
    frame.BackgroundColor3 = Color3.fromRGB(220, 240, 255)
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Draggable = true
    frame.Parent = gui
    local corner = Instance.new("UICorner", frame)
    corner.CornerRadius = UDim.new(0, 15)
    local gradient = Instance.new("UIGradient", frame)
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(200, 230, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(240, 250, 255))
    }
    gradient.Rotation = 90
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Text = "Matcha Key"
    title.TextColor3 = Color3.fromRGB(0, 100, 200)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 19
    title.Parent = frame
    -- Textbox
    local textbox = Instance.new("TextBox")
    textbox.Size = UDim2.new(1, -20, 0, 35)
    textbox.Position = UDim2.new(0, 10, 0, 40)
    textbox.PlaceholderText = "Enter Key..."
    textbox.Text = ""
    textbox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    textbox.TextColor3 = Color3.fromRGB(0, 100, 200)
    textbox.PlaceholderColor3 = Color3.fromRGB(100, 150, 220)
    textbox.Font = Enum.Font.SourceSans
    textbox.TextSize = 16
    textbox.Parent = frame
    local tbCorner = Instance.new("UICorner", textbox)
    tbCorner.CornerRadius = UDim.new(0, 10)
    -- Nút Get Key
    local getKeyBtn = Instance.new("TextButton")
    getKeyBtn.Size = UDim2.new(0.45, 0, 0, 35)
    getKeyBtn.Position = UDim2.new(0.05, 0, 0, 90)
    getKeyBtn.Text = "Get Key"
    getKeyBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    getKeyBtn.TextColor3 = Color3.new(1,1,1)
    getKeyBtn.Font = Enum.Font.SourceSansBold
    getKeyBtn.TextSize = 16
    getKeyBtn.Parent = frame
    local gkCorner = Instance.new("UICorner", getKeyBtn)
    gkCorner.CornerRadius = UDim.new(0, 10)
    -- Nút Check Key
    local checkKeyBtn = Instance.new("TextButton")
    checkKeyBtn.Size = UDim2.new(0.45, 0, 0, 35)
    checkKeyBtn.Position = UDim2.new(0.5, 0, 0, 90)
    checkKeyBtn.Text = "Check Key"
    checkKeyBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 150)
    checkKeyBtn.TextColor3 = Color3.new(1,1,1)
    checkKeyBtn.Font = Enum.Font.SourceSansBold
    checkKeyBtn.TextSize = 16
    checkKeyBtn.Parent = frame
    local ckCorner = Instance.new("UICorner", checkKeyBtn)
    ckCorner.CornerRadius = UDim.new(0, 10)
    -- Hover
    local function addHover(btn, hover, normal)
        btn.MouseEnter:Connect(function()
            game.TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = hover}):Play()
        end)
        btn.MouseLeave:Connect(function()
            game.TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = normal}):Play()
        end)
    end
    addHover(getKeyBtn, Color3.fromRGB(0, 180, 255), Color3.fromRGB(0, 150, 255))
    addHover(checkKeyBtn, Color3.fromRGB(0, 230, 180), Color3.fromRGB(0, 200, 150))
    -- Get Key
    getKeyBtn.MouseButton1Click:Connect(function()
        setclipboard("https://discord.gg/Vsnz2wfjP5")
        getKeyBtn.Text = "Copied!"
        game.TweenService:Create(getKeyBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(0, 255, 200)}):Play()
        wait(1.5)
        getKeyBtn.Text = "Get Key"
        game.TweenService:Create(getKeyBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(0, 150, 255)}):Play()
    end)
    -- Check Key
    checkKeyBtn.MouseButton1Click:Connect(function()
        if textbox.Text == correctKey then
            keyVerified = true
            -- Lưu key vào file
            writefile(keyFile, correctKey)
            -- Fade GUI + tuyết
            game.TweenService:Create(frame, TweenInfo.new(0.6), {BackgroundTransparency = 1}):Play()
            for _, v in pairs(frame:GetDescendants()) do
                if v:IsA("GuiObject") then
                    game.TweenService:Create(v, TweenInfo.new(0.6), {BackgroundTransparency = 1}):Play()
                end
                if v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
                    game.TweenService:Create(v, TweenInfo.new(0.6), {TextTransparency = 1}):Play()
                end
            end
            wait(0.6)
            gui:Destroy()
            if snowGui then snowGui:Destroy() end
        else
            textbox.Text = ""
            textbox.PlaceholderText = "Invalid Key!"
            local orig = textbox.Position
            for i = 1, 4 do
                textbox.Position = orig + UDim2.new(0, math.random(-4,4), 0, 0)
                wait(0.05)
            end
            textbox.Position = orig
        end
    end)
    -- === TUYẾT RƠI ĐƠN GIẢN: ĐƯỜNG THẲNG TỪ TRÊN XUỐNG ===
    spawn(function()
        snowGui = Instance.new("ScreenGui")
        snowGui.Parent = game.CoreGui
        snowGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        snowGui.DisplayOrder = 999
        local RunService = game:GetService("RunService")
        local screenSize = workspace.CurrentCamera.ViewportSize
        local snowParticles = {}
        -- Tạo 80 bông tuyết rơi thẳng
        for i = 1, 80 do
            local size = math.random(3, 8)
            local speed = math.random(2, 5)
            local snow = Instance.new("Frame")
            snow.Size = UDim2.new(0, size, 0, size)
            snow.Position = UDim2.new(0, math.random(0, screenSize.X), 0, math.random(-100, -20))
            snow.BackgroundColor3 = Color3.new(1,1,1)
            snow.BorderSizePixel = 0
            snow.ZIndex = 10
            snow.Parent = snowGui
            -- TRÒN 100%
            local corner = Instance.new("UICorner", snow)
            corner.CornerRadius = UDim.new(1, 0)
            table.insert(snowParticles, {
                obj = snow,
                y = snow.Position.Y.Offset,
                x = snow.Position.X.Offset,
                speed = speed
            })
        end
        -- Animation mượt, rơi thẳng
        local connection
        connection = RunService.Heartbeat:Connect(function()
            if not snowGui.Parent or keyVerified then
                connection:Disconnect()
                return
            end
            for _, p in pairs(snowParticles) do
                p.y = p.y + p.speed
                if p.y > screenSize.Y + 20 then
                    p.y = -20
                    p.x = math.random(0, screenSize.X)
                end
                p.obj.Position = UDim2.new(0, p.x, 0, p.y)
            end
        end)
    end)
end

-- Đợi key verified (nếu từ file hoặc GUI)
while not keyVerified do
    wait(0.1)
end
print("Valid Key! Running script...")
-- === CODE CHÍNH CỦA BẠN Ở ĐÂY ===
